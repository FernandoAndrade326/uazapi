[phases.setup]
nixPkgs = ["nodejs_20", "ffmpeg", "git"]

[phases.install]
cmds = [
    "npm install",
    "cp modelo-env.yml env.yml",
    # 1. Corrige o endereço do Redis (de localhost para o nome do serviço)
    "sed -i 's/host: localhost/host: evolution-api-redis/g' env.yml",
    "sed -i 's/127.0.0.1/evolution-api-redis/g' env.yml",
    # 2. Injeta a senha que achamos no lugar de 'null'
    "sed -i 's/password: null/password: e2f8f84532ba2a14ac0d/g' env.yml"
]

[start]
# Mostra o arquivo no log (para conferência) e inicia
cmd = "cat env.yml && npm run start"
